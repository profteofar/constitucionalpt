<!DOCTYPE html>
<html lang="pt-PT" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>200 Anos de Leis Fundamentais</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b',
                            950: '#020617',
                        }
                    }
                }
            }
        }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&family=Merriweather:ital,wght@0,400;0,700;1,700&display=swap');
        
        body {
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0, 0, 0, 0.1); }
        ::-webkit-scrollbar-thumb { background: rgba(255, 255, 255, 0.3); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(255, 255, 255, 0.5); }

        .serif { font-family: 'Merriweather', serif; }
        
        /* 3D Flip Utilities */
        .perspective-1000 { perspective: 1000px; }
        .transform-style-3d { transform-style: preserve-3d; }
        .backface-hidden { backface-visibility: hidden; }
        .rotate-y-180 { transform: rotateY(180deg); }
        .group:hover .rotate-y-180 { transform: rotateY(180deg); } 
        .flip-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }
        .group:hover .flip-card-inner { transform: rotateY(180deg); }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out forwards; }
        
        /* Print Styles */
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white !important; color: black !important; -webkit-print-color-adjust: exact; }
            #app-root { margin: 0; padding: 0; }
        }
    </style>
</head>
<body class="min-h-screen bg-[#5b21b6] bg-gradient-to-br from-[#4f46e5] to-[#7c3aed] dark:from-slate-900 dark:to-slate-950 text-slate-900 dark:text-slate-100 overflow-x-hidden selection:bg-indigo-200 transition-colors duration-500">
    
    <!-- Background Texture -->
    <div class="fixed inset-0 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')] opacity-10 pointer-events-none"></div>

    <!-- Main App Container -->
    <div id="app-root" class="relative z-10 flex flex-col min-h-screen"></div>

    <!-- Scroll to Top Button -->
    <button id="scrollTopBtn" onclick="scrollToTop()" class="fixed bottom-6 right-6 z-40 bg-indigo-600 text-white p-4 rounded-full shadow-xl opacity-0 pointer-events-none transition-all duration-300 hover:bg-indigo-700 hover:-translate-y-1 no-print">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Modals Container -->
    <div id="modal-container"></div>

    <script>
        // --- DADOS E CONSTANTES ---
        const INTRO_MEDIA = {
            video: "./video.mp4",
            podcast: "./podcast.mp3",
            image: "./infografia.jpg"
        };

        const INTRO_DOSSIER = [
          { t: "1.0 O Constitucionalismo como Sucessão de Ruturas", c: "A história constitucional portuguesa é marcada por uma sucessão de textos que representam verdadeiras ruturas radicais com o passado, mais do que simples revisões. É um campo de batalha ideológico entre visões distintas sobre soberania, arquitetura do poder e direitos." },
          { t: "2.0 1822: O Marco Fundador do Liberalismo", c: "Representa a rutura profunda com o Antigo Regime. Inspirada nas Constituições de Cádis (1812) e francesa (1791), consagrou a soberania residente na Nação, a supremacia do Legislativo unicameral e um catálogo de direitos individuais (liberdade, segurança, propriedade, igualdade)." },
          { t: "3.0 1826: O Compromisso Monárquico (Carta Outorgada)", c: "Uma concessão régia de D. Pedro IV (de cima para baixo). Introduziu o Poder Moderador (exclusivo do Rei) e o parlamentarismo bicameral com uma Câmara dos Pares nomeada. Representou um recuo face ao radicalismo de 1822." },
          { t: "5.0 1911: A Inauguração do Regime Republicano", c: "Consolida a Revolução de 5 de Outubro. Aboliu a Monarquia e o Poder Real. Introduziu o laicismo radical (separação Igreja-Estado), abolição da pena de morte militar e um parlamentarismo de assembleia onde o Congresso detinha a supremacia absoluta." },
          { t: "6.0 1933: A Institucionalização do Estado Novo", c: "Rutura total com o liberalismo. Criou um regime autoritário, corporativo e antiparlamentar. Enobreceu o Executivo (Salazar) e criou a Câmara Corporativa. As liberdades individuais foram esvaziadas por 'leis especiais' e pela polícia política (PIDE)." },
          { t: "7.0 1976: A Consolidação da Democracia", c: "Fruto do 25 de Abril. Pela primeira vez, elaborada por uma Assembleia eleita por sufrágio universal. Consagrou o Estado de Direito democrático, um vasto elenco de direitos fundamentais e o sistema semipresidencial para equilibrar os poderes." }
        ];

        const FLASHCARDS = [
          { f: "O que é uma Constituição?", b: "O 'manual de instruções' de um país que define regras de poder e direitos." },
          { f: "Soberania Nacional", b: "O poder pertence à Nação e não ao Rei sozinho (Princípio de 1822)." },
          { f: "Poder Moderador", b: "A 'chave do poder' exclusiva do Rei para equilibrar outros poderes (1826)." },
          { f: "Laicismo", b: "Separação total entre o Estado e as Igrejas (Grande marca de 1911)." },
          { f: "Sufrágio Universal", b: "O direito de todos os adultos votarem, independentemente de riqueza ou sexo (1976)." },
          { f: "Veto Suspensivo", b: "O Rei pode atrasar uma lei, mas não pode bloqueá-la se o Parlamento insistir." },
          { f: "Veto Absoluto", b: "Capacidade total do monarca ou presidente de impedir a aprovação de uma lei." },
          { f: "Corporativismo", b: "Sociedade organizada em grupos de interesses controlados pelo Estado (1933)." },
          { f: "Câmara dos Pares", b: "Câmara alta composta por nobres e clero nomeados pelo Rei (1826)." },
          { f: "Estado de Direito", b: "Regime onde as leis protegem o cidadão contra os abusos de quem governa." },
          { f: "Plebiscito", b: "Consulta direta ao povo, usada em 1933 para aprovar a Constituição do Estado Novo." },
          { f: "Estado Social", b: "Dever do Estado em garantir saúde, educação e proteção aos mais pobres (1976)." }
        ];

        const INTRO_QUIZ = [
          { q: "Qual foi a principal característica da Carta Constitucional de 1826 quanto à sua origem, em contraste com a de 1822?", o: ["Plebiscito nacional", "Vontade da Nação", "Concessão régia outorgada pelo monarca", "Imposição militar"], c: 2, f: "A Carta foi outorgada por D. Pedro IV, enquanto 1822 foi votada pelas Cortes." },
          { q: "A Constituição de 1838 aboliu que elemento fundamental da Carta de 1826?", o: ["A monarquia", "O Poder Moderador", "O veto real", "O ensino laico"], c: 1, f: "1838 eliminou o 4º poder (Moderador) para regressar à tripartição clássica." },
          { q: "Qual era a característica marcante da relação entre poderes na Constituição de 1911?", o: ["Supremacia do Executivo", "Poder absoluto do Presidente", "Clara supremacia do poder legislativo (Congresso)", "Corporativismo"], c: 2, f: "A 1ª República foi um parlamentarismo de assembleia onde o Congresso mandava." },
          { q: "Por que razão a Constituição de 1822 é considerada a mais radical do liberalismo monárquico?", o: ["Deu voto às mulheres", "Acabou com a religião", "Consagrou a soberania da Nação com supremacia sobre o Rei", "Aboliu a propriedade"], c: 2, f: "Colocou as Cortes acima do monarca, reduzindo-o a um executor." },
          { q: "Que traço distintivo marcou a Constituição de 1933 que instituiu o Estado Novo?", o: ["Pluralismo", "Adoção de um modelo Corporativista e Autoritário", "Liberdade de imprensa", "Eleições livres"], c: 1, f: "O corporativismo era a base da organização social e política de Salazar." },
          { q: "O que define o 'Poder Constituinte'?", o: ["Poder de julgar crimes", "Poder de criar ou modificar a Constituição", "Poder do Rei", "Poder do Exército"], c: 1, f: "É a capacidade extraordinária de criar as regras fundamentais do Estado." },
          { q: "Quantas Constituições definitivas (sem contar revisões) vigoraram em Portugal?", o: ["Duas", "Dez", "Seis (1822, 1826, 1838, 1911, 1933, 1976)", "Quatro"], c: 2, f: "Foram seis textos fundamentais que marcaram a nossa história." },
          { q: "Qual o significado de 'Estado de Direito'?", o: ["O Estado manda em tudo", "O Governo está acima da Lei", "Todos, incluindo o Estado, obedecem à Lei", "Só os juízes mandam"], c: 2, f: "Garante que o poder é limitado pela lei para proteger os cidadãos." },
          { q: "A Constituição de 1976 foi a primeira a garantir...", o: ["A Monarquia", "O Sufrágio Universal pleno", "A Escravatura", "A Inquisição"], c: 1, f: "Foi a primeira vez que todos os cidadãos maiores de idade puderam votar livremente." },
          { q: "O 'Setembrismo' (1836) levou ao regresso provisório de que texto?", o: ["Carta de 1826", "Constituição de 1822", "Constituição de 1933", "Constituição Espanhola"], c: 1, f: "Os setembristas recuperaram o espírito radical de 1822 contra a Carta." }
        ];

        const MODULES = {
          '1822': {
            id: '1822',
            label: 'O Nascimento Liberal',
            title: 'Constituição de 1822',
            color: 'indigo',
            sub: 'Do absolutismo à soberania da Nação.',
            infoImage: './info1822.jpg',
            videoSrc: './video1822.mp4',
            guide: [
                { t: "A Revolução de 1820", c: "Portugal estava devastado pelas invasões francesas e governado por generais ingleses enquanto o Rei estava no Brasil. A Revolução surgiu para restaurar a dignidade nacional e criar o 'manual de instruções' do país." },
                { t: "Soberania na Nação", c: "A grande rutura: o poder já não vem de Deus para o Rei, mas reside na Nação. O Parlamento (Cortes) passa a ser unicameral e superior ao Rei." },
                { t: "Separação de Poderes", c: "A Constituição consagrou a clássica divisão tripartida: Legislativo (Cortes), Executivo (Rei e Ministros) e Judicial (Juízes), rompendo com a concentração de poderes do Absolutismo." },
                { t: "Supremacia das Cortes", c: "As Cortes (Parlamento) eram o centro da vida política. Sendo eleitas, representavam a vontade da Nação e tinham superioridade sobre o Rei, que não as podia dissolver." },
                { t: "Direitos e Deveres", c: "Estabeleceu um catálogo de direitos fundamentais: liberdade, segurança e propriedade. Aboliu a tortura e a Inquisição, afirmando a dignidade humana, embora mantendo a escravatura nas colónias." },
                { t: "O Rei Constitucional", c: "O monarca deixou de ser senhor absoluto para ser o 'primeiro magistrado da nação'. O seu poder foi limitado e o seu veto sobre as leis era apenas suspensivo, não definitivo." },
                { t: "A Questão Religiosa", c: "Apesar do liberalismo, manteve o Catolicismo como religião oficial e única para os portugueses, proibindo o culto público de outras confissões, num compromisso com a tradição." }
            ],
            activity: { t: "O Puzzle dos Poderes", c: "Imagina que tens 3 caixas: Legislativo, Executivo e Judicial. No Absolutismo, o Rei tinha as 3. Em 1822, as peças separaram-se para garantir a liberdade. Que tarefas atribuirias às Cortes?" },
            quiz: [
                { q: "Qual a fonte estrangeira mais imediata e influente para a Constituição de 1822?", o: ["Constituição dos EUA (1787)", "Constituição de Cádis (1812)", "Carta Francesa (1814)", "Bill of Rights (1689)"], c: 1, f: "A Constituição espanhola de Cádis foi a grande inspiradora do vintismo." },
                { q: "A decisão pré-constituinte de 1822 insurgiu-se diretamente contra:", o: ["A ocupação britânica", "A monarquia espanhola", "A revolução francesa", "O clero"], c: 0, f: "A Revolução Liberal de 1820 foi, em parte, uma reação ao domínio inglês em Portugal." },
                { q: "Que conceito político fundamental substituiu a legitimidade paternalista do monarca?", o: ["Soberania Nacional", "Direito Divino", "Absolutismo", "Corporativismo"], c: 0, f: "O poder passou a residir na Nação e não na figura do Rei." },
                { q: "Como se caracterizava o Parlamento (Cortes) em 1822?", o: ["Bicameral", "Unicameral", "Tricameral", "Consultivo"], c: 1, f: "Era constituído apenas por uma Câmara de Deputados eleita." },
                { q: "Qual era o poder do Rei sobre as leis aprovadas pelas Cortes?", o: ["Veto absoluto", "Veto suspensivo", "Nenhum poder", "Poder de emenda"], c: 1, f: "O Rei podia adiar (suspender) a lei, mas se as Cortes insistissem, tinha de promulgar." },
                { q: "Quem estava explicitamente excluído do direito de voto em 1822?", o: ["Comerciantes", "Proprietários", "Mulheres e analfabetos", "Militares"], c: 2, f: "O sufrágio não era totalmente universal; mulheres e servos/analfabetos foram excluídos." },
                { q: "O que eram as 'Bases da Constituição' de 1821?", o: ["Um rascunho secreto", "Um documento provisório", "Um tratado com Espanha", "Uma lei agrária"], c: 1, f: "Foi um texto temporário para vigorar enquanto a Constituição completa era redigida." },
                { q: "Qual o evento que levou à suspensão da Constituição em 1823?", o: ["A Vilafrancada", "A Maria da Fonte", "O 5 de Outubro", "A Implantação da República"], c: 0, f: "A Vilafrancada marcou o golpe absolutista que suspendeu o texto liberal." },
                { q: "Segundo a Constituição, quem detinha exclusivamente o poder judicial?", o: ["O Rei", "As Cortes", "Os Juízes", "O Governo"], c: 2, f: "Estabeleceu-se a separação de poderes, com tribunais independentes." },
                { q: "Qual a posição da Constituição de 1822 sobre a religião?", o: ["Liberdade total", "Catolicismo como única religião da Nação", "Ateísmo de Estado", "Protestantismo"], c: 1, f: "Embora liberal, manteve o Catolicismo como religião oficial e única para os nacionais." },
                { q: "Os deputados às Cortes Constituintes eram maioritariamente...", o: ["Operários", "Juristas e Magistrados", "Militares de baixa patente", "Agricultores"], c: 1, f: "A burguesia letrada dominou a elaboração do texto." },
                { q: "A Constituição de 1822 inspirou-se na tradição do...", o: ["Direito Natural", "Direito Canónico", "Direito Feudal", "Direito Soviético"], c: 0, f: "Os direitos naturais do homem foram a base filosófica." },
                { q: "O sufrágio para eleição dos deputados era...", o: ["Universal e Direto", "Direto", "Indireto (em graus)", "Censitário muito restrito"], c: 1, f: "Ao contrário de Cádis (indireto), Portugal optou pelo sufrágio direto." },
                { q: "O que aconteceu aos forais e privilégios feudais?", o: ["Foram abolidos", "Foram reforçados", "Foram mantidos", "Transformados em imposto"], c: 0, f: "O liberalismo visava destruir a ordem do Antigo Regime." },
                { q: "A soberania em 1822 residia em quem?", o: ["Rei", "Deus", "Nação", "Exército"], c: 2, f: "A Nação passou a ser a fonte do poder." },
                { q: "Qual foi o argumento de D. João VI para anular a Constituição em 1823?", o: ["Era demasiado longa", "Incompatível com hábitos do povo", "Cópia da inglesa", "Apoiada por Espanha"], c: 1, f: "Alegou que a Constituição não servia os costumes tradicionais portugueses." },
                { q: "As Cortes de 1822 reuniam-se...", o: ["Apenas quando o Rei chamava", "Automaticamente (direito próprio)", "A cada 4 anos", "No Porto"], c: 1, f: "As Cortes tinham soberania para reunir sem depender da vontade real." },
                { q: "A Constituição de 1822 garantiu a liberdade de...", o: ["Imprensa", "Culto público (para outras religiões)", "Escravatura", "Divórcio"], c: 0, f: "A liberdade de imprensa foi uma das grandes conquistas liberais." },
                { q: "Quem organizou a Revolução Liberal do Porto?", o: ["O Sinédrio", "A Maçonaria Inglesa", "O Papa", "Napoleão"], c: 0, f: "Foi o Sinédrio, liderado por Manuel Fernandes Tomás." },
                { q: "Quantas câmaras tinha o Parlamento?", o: ["Uma", "Duas", "Três", "Quatro"], c: 0, f: "O unicameralismo foi uma marca radical face ao bicameralismo conservador." }
            ]
          },
          '1911': {
            id: '1911',
            label: 'A Rutura Republicana',
            title: 'Constituição de 1911',
            color: 'purple',
            sub: 'O fim da Monarquia e o Laicismo.',
            infoImage: './info1911.jpg',
            videoSrc: './video1911.mp4',
            guide: [
                { t: "A Queda do Rei", c: "A implantação da República trouxe uma rutura total com o passado monárquico. A Constituição foi elaborada por uma Assembleia eleita para consolidar os ideais de liberdade." },
                { t: "O Estado Laico", c: "A separação total entre Igreja e Estado. Introduziu o registo civil obrigatório, o ensino laico e a religião passou a ser um assunto privado." },
                { t: "Supremacia Parlamentar", c: "O Congresso da República (Parlamento) detinha o poder supremo, elegendo e destituindo o Presidente e o Governo, o que gerou instabilidade governativa e a chamada 'ditadura parlamentar'." },
                { t: "Presidente da República", c: "Eleito pelo Parlamento (não pelo povo), tinha poderes muito limitados. Não tinha direito de veto absoluto nem, inicialmente, o poder de dissolver o Congresso, sendo uma figura decorativa." },
                { t: "Direitos Sociais", c: "Introduziu novas preocupações com o trabalho: direito à greve (embora regulada), descanso semanal e proteção social, respondendo às crescentes reivindicações do movimento operário." },
                { t: "Simbologia Republicana", c: "Adoção da bandeira verde e rubra e do hino 'A Portuguesa', rompendo radicalmente com a simbologia azul e branca da monarquia para marcar a nova identidade nacional." },
                { t: "Família e Educação", c: "Instituiu o divórcio e o registo civil obrigatório. O Estado assumiu o ensino como laico e prioritário, procurando formar cidadãos republicanos livres da influência da Igreja." }
            ],
            activity: { t: "A Nova Identidade", c: "Mudamos a bandeira e o hino. Discute: por que razão mudar os símbolos é importante para marcar um novo regime político? Que sentimentos os novos símbolos transmitem?" },
            quiz: [
                { q: "Qual a decisão pré-constituinte que levou à Constituição de 1911?", o: ["Abolição da Monarquia", "Guerra Civil", "União Ibérica", "Referendo"], c: 0, f: "A República foi proclamada antes da Constituição, abolindo logo a monarquia." },
                { q: "Qual a principal influência estrangeira da Constituição de 1911?", o: ["Constituição Brasileira (1891)", "Constituição Alemã", "Carta Italiana", "Constituição Soviética"], c: 0, f: "A Constituição brasileira serviu de modelo, tal como a francesa." },
                { q: "O sistema de governo instituído em 1911 foi...", o: ["Presidencialista", "Parlamentarista", "Monárquico", "Ditatorial"], c: 1, f: "Foi um parlamentarismo puro, com supremacia do Congresso." },
                { q: "Quem elegia o Presidente da República?", o: ["Sufrágio Universal", "O Congresso", "Os Militares", "Os Juízes"], c: 1, f: "O Presidente era eleito pelos deputados e senadores, não pelo povo." },
                { q: "Como era composto o Congresso da República?", o: ["Câmara de Deputados e Senado", "Apenas Câmara de Deputados", "Senado e Conselho Real", "Câmara Corporativa"], c: 0, f: "O Parlamento era bicameral: Deputados e Senado." },
                { q: "A Constituição de 1911 permitiu o voto às mulheres?", o: ["Sim, a todas", "Não (salvo raras exceções)", "Sim, se casadas", "Sim, se ricas"], c: 1, f: "As mulheres continuaram excluídas do direito de voto." },
                { q: "Que medida refletiu o pendor laicista da Constituição?", o: ["Ensino religioso obrigatório", "Registo Civil obrigatório", "Apoio financeiro à Igreja", "Criação de feriados religiosos"], c: 1, f: "O Estado assumiu o registo dos cidadãos, retirando esse poder à Igreja." },
                { q: "O mandato do Presidente da República era de...", o: ["4 anos", "5 anos", "7 anos", "Vitalício"], c: 0, f: "O mandato era curto (4 anos) para evitar concentração de poder." },
                { q: "Quem podia dissolver o Congresso (Parlamento)?", o: ["O Presidente (livremente)", "Ninguém (inicialmente)", "O Governo", "O Exército"], c: 1, f: "Originalmente, o Presidente não podia dissolver o Parlamento, o que gerava instabilidade." },
                { q: "Que alteração introduziu Sidónio Pais em 1918?", o: ["Presidencialismo", "Monarquia", "Comunismo", "Teocracia"], c: 0, f: "Sidónio instaurou uma 'República Nova' de cariz presidencialista." },
                { q: "O Governo era politicamente responsável perante quem?", o: ["O Presidente", "O Congresso", "O Povo", "Os Tribunais"], c: 1, f: "O Congresso podia demitir o governo através de moções de desconfiança." },
                { q: "Qual a nova bandeira nacional adotada?", o: ["Azul e Branca", "Verde e Rubra", "Amarela e Preta", "Toda Vermelha"], c: 1, f: "As cores do Partido Republicano substituíram as da monarquia." },
                { q: "O que causou o fim da vigência da Constituição de 1911?", o: ["Revisão de 1930", "Revolta de 28 de Maio de 1926", "Entrada na UE", "Morte do Rei"], c: 1, f: "O golpe militar de 1926 pôs fim à I República e à sua Constituição." },
                { q: "A laicização incluiu a secularização de...", o: ["Cemitérios", "Quartéis", "Casas privadas", "Roupas"], c: 0, f: "Os cemitérios passaram a ser públicos e não religiosos." },
                { q: "Qual foi o papel de Sidónio Pais no sistema eleitoral?", o: ["Aboliu o voto", "Introduziu o sufrágio universal (mas durou pouco)", "Deu voto às mulheres", "Proibiu partidos"], c: 1, f: "Tentou alargar a base eleitoral com o sufrágio universal em 1918." },
                { q: "O Senado (Câmara Alta) era eleito por...", o: ["Nomeação do Rei", "Sufrágio direto", "Municípios e representantes", "Sorteio"], c: 2, f: "Tinha uma representação mais ligada aos distritos e municípios." },
                { q: "O Presidente da República tinha poder de veto?", o: ["Absoluto", "Não tinha", "Suspensivo (limitado)", "Apenas militar"], c: 1, f: "O Presidente tinha poderes muito limitados face ao Parlamento." },
                { q: "Qual era a principal crítica ao sistema de 1911?", o: ["Instabilidade governativa", "Excesso de poder do Presidente", "Falta de liberdade", "Monarquismo"], c: 0, f: "A supremacia do Parlamento gerava quedas constantes de governo." },
                { q: "A Constituição previa o 'Habeas Corpus'?", o: ["Sim", "Não", "Apenas para ricos", "Apenas para políticos"], c: 0, f: "Sim, garantia a proteção contra prisões ilegais." },
                { q: "Quem foi o primeiro Presidente eleito ao abrigo desta Constituição?", o: ["Manuel de Arriaga", "Teófilo Braga", "Sidónio Pais", "Salazar"], c: 0, f: "Manuel de Arriaga foi o primeiro PR constitucional." }
            ]
          },
          '1933': {
            id: '1933',
            label: 'O Interregno Autoritário',
            title: 'Constituição de 1933',
            color: 'slate',
            sub: 'O Estado Novo e a República Corporativa.',
            infoImage: './info1933.jpg',
            videoSrc: './video1933.jpg', 
            guide: [
                { t: "A Ditadura Nacional", c: "Nascida da revolução militar de 1926 e desenhada por Salazar. Foi aprovada por plebiscito onde a abstenção contou como voto favorável." },
                { t: "Estado Corporativo", c: "A sociedade era organizada em corporações controladas pelo Estado. Rejeitava a democracia parlamentar e o conflito de opiniões." },
                { t: "Poder Executivo Forte", c: "Inverteu a lógica de 1911: o Governo (Salazar) não dependia do Parlamento, mas da confiança política do Presidente da República, garantindo uma estabilidade de cariz autoritário." },
                { t: "Restrição de Liberdades", c: "Embora a Constituição listasse liberdades (expressão, reunião), remetia a sua regulação para 'leis especiais' que, na prática, as anulavam através da censura prévia e da polícia política." },
                { t: "Câmara Corporativa", c: "Órgão consultivo que funcionava junto ao Parlamento, representando os 'interesses organizados' (famílias, autarquias, sindicatos nacionais), substituindo a lógica partidária." },
                { t: "Nacionalismo Imperial", c: "Definiu Portugal como uma nação pluricontinental. O Acto Colonial integrou a estrutura constitucional, rejeitando a autonomia das colónias e afirmando a missão civilizadora." },
                { t: "Assembleia Nacional", c: "O Parlamento reunia apenas 3 meses por ano e tinha poderes limitados de fiscalização, servindo mais como órgão de legitimação do regime do que de decisão efetiva." }
            ],
            activity: { t: "A Tesoura da Censura", c: "Imagina escreveres no jornal da escola que queres mudar a direção. No Estado Novo, o 'Lápis Azul' riscava a tua frase. Como te sentirias se não pudesses expressar a tua opinião?" },
            quiz: [
                { q: "Qual o evento que marcou a decisão pré-constituinte de 1933?", o: ["25 de Abril", "28 de Maio de 1926", "Implantação da República", "Terramoto de Lisboa"], c: 1, f: "A Ditadura Militar instaurada em 1926 preparou o caminho para o Estado Novo." },
                { q: "Como foi aprovada a Constituição de 1933?", o: ["Votação no Parlamento", "Plebiscito Nacional", "Decreto Real", "Acordo partidário"], c: 1, f: "Foi submetida a referendo, onde as abstenções contaram como 'Sim'." },
                { q: "O Estado Novo definia-se como uma República...", o: ["Unitária e Corporativa", "Federal e Socialista", "Monárquica e Liberal", "Parlamentar"], c: 0, f: "O corporativismo era a base estrutural do regime." },
                { q: "Que documento regulava as colónias com força constitucional?", o: ["Acto Colonial", "Tratado de Tordesilhas", "Carta das Nações", "Lei da Terra"], c: 0, f: "O Acto Colonial integrava a estrutura constitucional do Império." },
                { q: "Qual era o partido único permitido legalmente?", o: ["Partido Socialista", "União Nacional", "Partido Comunista", "Bloco de Esquerda"], c: 1, f: "A oposição era ilegal; apenas a União Nacional operava." },
                { q: "Como funcionava a censura (Exame Prévio)?", o: ["Apenas para livros", "Cortava notícias antes da publicação", "Era voluntária", "Não existia"], c: 1, f: "A imprensa era visada pelo 'lápis azul' antes de chegar às bancas." },
                { q: "Quem era a figura dominante do regime, apesar da estrutura formal?", o: ["O Presidente da República", "O Presidente do Conselho (Salazar)", "O Rei", "O Cardeal"], c: 1, f: "Salazar, como chefe do governo, detinha o poder real." },
                { q: "O Parlamento era constituído por...", o: ["Assembleia Nacional e Câmara Corporativa", "Senado e Congresso", "Câmara dos Lordes", "Assembleia Popular"], c: 0, f: "Havia uma câmara de deputados e uma câmara consultiva (Corporativa)." },
                { q: "A revisão constitucional de 1959 alterou a eleição do Presidente para...", o: ["Sufrágio Direto", "Colégio Eleitoral (Indireto)", "Sorteio", "Hereditário"], c: 1, f: "Após a campanha de Humberto Delgado, o regime acabou com o voto direto para PR." },
                { q: "Os direitos e liberdades previstos na Constituição eram...", o: ["Absolutos", "Limitados por 'leis especiais'", "Inexistentes", "Iguais aos de hoje"], c: 1, f: "As leis especiais esvaziavam na prática os direitos consagrados." },
                { q: "A Constituição de 1933 inspirou-se em parte no modelo...", o: ["Soviético", "Fascista Italiano", "Americano", "Britânico"], c: 1, f: "O corporativismo italiano foi uma das influências, embora adaptado." },
                { q: "O que aconteceu ao direito à greve?", o: ["Foi garantido", "Foi proibido", "Era obrigatório", "Apenas ao fim de semana"], c: 1, f: "As greves eram proibidas e consideradas crimes contra a economia." },
                { q: "Quem elaborou o projeto da Constituição?", o: ["Uma Assembleia Eleita", "Um grupo liderado por Salazar", "A ONU", "O Povo"], c: 1, f: "Foi um projeto elaborado pelo governo ditatorial, não por deputados." },
                { q: "Qual era o papel da Câmara Corporativa?", o: ["Fazer leis", "Julgar crimes", "Consultivo (dar pareceres)", "Comandar o exército"], c: 2, f: "Representava os grupos profissionais e dava pareceres técnicos." },
                { q: "O 'Plataformas de Acordo Constitucional' refere-se a...", o: ["1933", "1976", "1822", "1911"], c: 1, f: "Esta é uma rasteira! Plataformas de Acordo é do processo de 1976. Em 1933 foi imposição." },
                { q: "A Constituição de 1933 vigorou até...", o: ["1945", "1974", "1986", "2000"], c: 1, f: "Caiu com a Revolução dos Cravos em 25 de Abril de 1974." },
                { q: "O regime rejeitava o...", o: ["Nacionalismo", "Liberalismo político e partidário", "Catolicismo", "Colonialismo"], c: 1, f: "Era um regime antiparlamentar e antiliberal." },
                { q: "A economia era definida como...", o: ["Comunista", "Corporativa e condicionada", "Livre mercado total", "Feudal"], c: 1, f: "O Estado controlava e condicionava a atividade económica." },
                { q: "Qual o estatuto da Constituição logo após o 25 de Abril?", o: ["Revogada/Substituída por leis constitucionais", "Mantida integralmente", "Traduzida para inglês", "Vendida"], c: 0, f: "Foi desmantelada e substituída temporariamente até 1976." },
                { q: "O que eram as 'eleições' durante o Estado Novo?", o: ["Livres e justas", "Controladas e não competitivas", "Sempre ganhas pela oposição", "Digitais"], c: 1, f: "Eram atos de legitimação do regime sem verdadeira concorrência." }
            ]
          },
          '1976': {
            id: '1976',
            label: 'A Democracia de Abril',
            title: 'Constituição de 1976',
            color: 'emerald',
            sub: 'O regresso à liberdade e o Sufrágio Universal.',
            infoImage: './info1976.jpg',
            videoSrc: './video1976.mp4',
            guide: [
                { t: "A Revolução dos Cravos", c: "A 25 de Abril de 1974, os militares puseram fim a 48 anos de ditadura. O objetivo era: descolonizar, democratizar e desenvolver." },
                { t: "O Sufrágio Universal", c: "Pela primeira vez em décadas, todos os portugueses (homens e mulheres) votaram para a Constituinte. O voto tornou-se a voz real do povo." },
                { t: "Sistema Semipresidencialista", c: "Sistema misto de equilíbrio: o Presidente é eleito diretamente e tem poderes reais (veto, dissolução), mas o Governo responde perante o Parlamento, evitando ditaduras." },
                { t: "Estado Social", c: "Compromisso do Estado em garantir direitos sociais universais: Serviço Nacional de Saúde, Segurança Social, Educação Pública e Habitação, protegendo os mais vulneráveis." },
                { t: "Poder Local Democrático", c: "Criação das Autarquias Locais (Câmaras e Assembleias Municipais) eleitas, descentralizando o poder e aproximando a decisão das populações, rompendo com o centralismo anterior." },
                { t: "Autonomias Regionais", c: "Reconhecimento das especificidades geográficas e históricas dos arquipélagos, criando as Regiões Autónomas dos Açores e Madeira com governos e parlamentos próprios." },
                { t: "Tribunal Constitucional", c: "Criação de um 'guardião' (em 1982) para fiscalizar as leis, garantindo que nenhuma norma viola os princípios fundamentais e os direitos dos cidadãos consagrados na Constituição." }
            ],
            activity: { t: "A Minha Primeira Urna", c: "Simula uma eleição na turma para uma decisão simples. Usa voto secreto. Discute por que razão o voto livre é o pilar da nossa liberdade atual." },
            quiz: [
                { q: "Qual o evento histórico 'pré-constituinte' da Constituição de 1976?", o: ["25 de Abril de 1974", "Entrada na CEE", "Guerra Colonial", "Morte de Salazar"], c: 0, f: "A Revolução dos Cravos abriu caminho à democracia." },
                { q: "Quem elaborou a Constituição de 1976?", o: ["O MFA sozinho", "Uma Assembleia Constituinte eleita", "O Presidente Spínola", "A União Europeia"], c: 1, f: "Foi redigida por deputados eleitos livremente pelo povo." },
                { q: "O texto original de 1976 apontava para...", o: ["Uma monarquia", "A transição para o socialismo", "O fascismo", "O feudalismo"], c: 1, f: "O texto original tinha uma forte carga ideológica socialista." },
                { q: "Que órgão militar foi extinto na revisão de 1982?", o: ["Conselho da Revolução", "Exército", "GNR", "Polícia Judiciária"], c: 0, f: "A extinção do Conselho da Revolução normalizou a democracia civil." },
                { q: "A Constituição de 1976 consagrou pela primeira vez...", o: ["O voto censitário", "O sufrágio universal pleno", "A escravatura", "A pena de morte"], c: 1, f: "Todos os cidadãos maiores de idade ganharam direito de voto." },
                { q: "Qual o sistema de governo consagrado?", o: ["Presidencialista", "Semipresidencialista", "Parlamentar puro", "Monárquico"], c: 1, f: "O poder é partilhado entre Presidente (eleito) e Parlamento/Governo." },
                { q: "Que documento de direitos humanos tem valor constitucional?", o: ["Declaração Universal dos Direitos do Homem", "Magna Carta", "Código de Hamurabi", "Bula Papal"], c: 0, f: "A DUDH é referenciada diretamente na Constituição." },
                { q: "A revisão de 1989 foi importante para permitir...", o: ["A prisão perpétua", "As reprivatizações", "O regresso do Rei", "A censura"], c: 1, f: "Permitou reverter as nacionalizações do período revolucionário." },
                { q: "O sistema eleitoral para a Assembleia da República é...", o: ["Maioritário (vence quem tem mais votos)", "Proporcional (Método de Hondt)", "Sorteio", "Uninominal"], c: 1, f: "Garante representação aos partidos segundo a sua percentagem de votos." },
                { q: "Qual a função do Tribunal Constitucional (criado em 1982)?", o: ["Julgar roubos", "Fiscalizar se as leis cumprem a Constituição", "Comandar a polícia", "Fazer leis"], c: 1, f: "É o guardião da Constituição." },
                { q: "A Constituição define Portugal como um Estado de...", o: ["Direito Democrático", "Novo", "Sítio", "Guerra"], c: 0, f: "O Estado de Direito garante que todos, incluindo o Estado, obedecem à lei." },
                { q: "O que são 'limites materiais' de revisão (cláusulas pétreas)?", o: ["Pedras da calçada", "Coisas que não se podem mudar na Constituição", "O muro de Berlim", "Materiais de construção"], c: 1, f: "São princípios intocáveis, como a forma republicana e os direitos dos trabalhadores." },
                { q: "Qual era o papel do 'Plataformas de Acordo Constitucional'?", o: ["Acordo entre MFA e Partidos", "Plano de comboios", "Tratado com Espanha", "Lei da Pesca"], c: 0, f: "Foi um pacto que impôs certas regras militares à Assembleia Constituinte." },
                { q: "A saúde é um direito garantido através de...", o: ["Seguros privados", "Serviço Nacional de Saúde (SNS)", "Caridade", "Sorte"], c: 1, f: "O SNS universal e tendencialmente gratuito é uma conquista de 1976." },
                { q: "Quantas revisões teve a Constituição de 1976 até hoje?", o: ["Nenhuma", "Sete", "Cinquenta", "Duas"], c: 1, f: "O texto foi ajustado 7 vezes para se adaptar aos tempos e à UE." },
                { q: "O que aconteceu à PIDE após a revolução?", o: ["Foi extinta", "Mudou de nome", "Continuou igual", "Foi elogiada"], c: 0, f: "A polícia política da ditadura foi desmantelada." },
                { q: "As regiões autónomas (Açores e Madeira) têm...", o: ["Independência total", "Estatutos Político-Administrativos próprios", "Reis próprios", "Moeda própria"], c: 1, f: "A Constituição garante autonomia política e administrativa às ilhas." },
                { q: "O Presidente da República é eleito por...", o: ["Voto direto dos cidadãos", "Parlamento", "Governo", "Sorteio"], c: 0, f: "É uma eleição direta, exigindo maioria absoluta." },
                { q: "Qual o limite de mandatos consecutivos do Presidente?", o: ["Um", "Dois", "Três", "Sem limite"], c: 1, f: "Pode cumprir no máximo dois mandatos seguidos (10 anos)." },
                { q: "A Constituição proíbe explicitamente partidos...", o: ["De esquerda", "De direita", "Fascistas ou racistas", "Ecológicos"], c: 2, f: "Organizações que perfilhem a ideologia fascista não são permitidas." }
            ]
          }
        };

        const MODULE_ORDER = ['intro', '1822', '1911', '1933', '1976', 'finish'];
        const TOTAL_QUESTIONS = INTRO_QUIZ.length + Object.values(MODULES).reduce((acc, m) => acc + m.quiz.length, 0);

        // --- ESTADO DA APLICAÇÃO ---
        const APP_STATE = {
            view: 'welcome',
            user: { name: '', score: 0, answers: [] },
            isMenuOpen: false,
            activeAccordion: null,
            quizState: {}, // { moduleId: { qIdx: { selectedIndex: number, isCorrect: boolean } } }
            inputName: '',
            challengeInput: '',
            challengeData: null, // { title, desc }
            theme: localStorage.getItem('theme') || 'light'
        };

        // --- LÓGICA DE RENDERIZAÇÃO E NAVEGAÇÃO ---

        function init() {
            // Inicializar tema
            if (APP_STATE.theme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }

            // Scroll to top button logic
            window.addEventListener('scroll', () => {
                const btn = document.getElementById('scrollTopBtn');
                if (window.scrollY > 300) {
                    btn.classList.remove('opacity-0', 'pointer-events-none');
                } else {
                    btn.classList.add('opacity-0', 'pointer-events-none');
                }
            });

            render();
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function toggleTheme() {
            APP_STATE.theme = APP_STATE.theme === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', APP_STATE.theme);
            if (APP_STATE.theme === 'dark') {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            render();
        }

        function navigateTo(viewName) {
            APP_STATE.view = viewName;
            APP_STATE.isMenuOpen = false;
            APP_STATE.activeAccordion = null;
            window.scrollTo(0, 0);
            render();
        }

        function handleStart() {
            if (APP_STATE.inputName.trim()) {
                APP_STATE.user.name = APP_STATE.inputName;
                navigateTo('intro');
            }
        }

        function handleQuizAnswer(moduleId, qIdx, oIdx, questionObj) {
            if (!APP_STATE.quizState[moduleId]) APP_STATE.quizState[moduleId] = {};
            if (APP_STATE.quizState[moduleId][qIdx]) return; // Já respondido

            const isCorrect = oIdx === questionObj.c;
            
            // Gravar estado local
            APP_STATE.quizState[moduleId][qIdx] = { selectedIndex: oIdx, isCorrect: isCorrect };

            // Gravar estado global do user
            APP_STATE.user.score += isCorrect ? 1 : 0;
            APP_STATE.user.answers.push({
                moduleId: moduleId,
                questionIndex: qIdx,
                isCorrect: isCorrect,
                selected: questionObj.o[oIdx],
                correct: questionObj.o[questionObj.c],
                question: questionObj.q,
                feedback: questionObj.f
            });

            render(); // Re-render para mostrar feedback
        }
        
        // --- TECLADO E ACESSIBILIDADE ---
        
        function handleNavKeydown(e) {
            const buttons = Array.from(e.currentTarget.querySelectorAll('button'));
            const index = buttons.indexOf(document.activeElement);
            if (index === -1) return;

            let nextIndex;
            if (e.key === 'ArrowRight') {
                nextIndex = (index + 1) % buttons.length;
                buttons[nextIndex].focus();
                e.preventDefault();
            } else if (e.key === 'ArrowLeft') {
                nextIndex = (index - 1 + buttons.length) % buttons.length;
                buttons[nextIndex].focus();
                e.preventDefault();
            }
        }
        
        function handleAccordionKeydown(e) {
            const buttons = Array.from(e.currentTarget.querySelectorAll('button[data-accordion="true"]'));
            const index = buttons.indexOf(document.activeElement);
            if (index === -1) return;

            let nextIndex;
            if (e.key === 'ArrowDown') {
                nextIndex = (index + 1) % buttons.length;
                buttons[nextIndex].focus();
                e.preventDefault();
            } else if (e.key === 'ArrowUp') {
                nextIndex = (index - 1 + buttons.length) % buttons.length;
                buttons[nextIndex].focus();
                e.preventDefault();
            }
        }

        function getProgress() {
            const idx = MODULE_ORDER.indexOf(APP_STATE.view);
            if (idx === -1) return 0;
            return (idx / (MODULE_ORDER.length - 1)) * 100;
        }

        // --- FUNÇÕES DE COMPONENTES ---

        function renderNavbar() {
            if (APP_STATE.view === 'welcome') return '';

            const navButtons = MODULE_ORDER.filter(m => m !== 'finish').map(m => `
                <button onclick="navigateTo('${m}')" 
                    class="px-4 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${APP_STATE.view === m ? 'bg-white text-indigo-700 shadow-md transform scale-105' : 'text-white/60 hover:text-white hover:bg-white/10 dark:text-slate-300 dark:hover:text-white'}">
                    ${m === 'intro' ? 'Intro' : m}
                </button>
            `).join('');

            const mobileMenu = APP_STATE.isMenuOpen ? `
                <div class="md:hidden absolute top-20 left-0 w-full bg-[#4f46e5] dark:bg-slate-900 border-t border-white/10 p-4 flex flex-col gap-2 shadow-xl animate-fade-in z-50">
                    ${MODULE_ORDER.map(m => `
                        <button onclick="navigateTo('${m}')" class="p-3 text-left font-bold text-white hover:bg-white/20 rounded-lg uppercase text-sm">
                            ${m === 'intro' ? 'Introdução' : m === 'finish' ? 'Certificado' : `Constituição de ${m}`}
                        </button>
                    `).join('')}
                </div>
            ` : '';

            return `
                <nav class="sticky top-0 z-50 backdrop-blur-md border-b border-white/10 dark:bg-slate-900/90 dark:border-slate-700 shadow-lg no-print transition-colors duration-500">
                    <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
                        <div class="flex items-center gap-3 cursor-pointer group" onclick="navigateTo('intro')" tabindex="0" onkeydown="if(event.key === 'Enter' || event.key === ' ') navigateTo('intro')">
                            <div class="w-8 h-8 bg-white text-indigo-700 rounded-lg flex items-center justify-center shadow-lg group-hover:scale-110 transition">
                                <i class="fas fa-balance-scale"></i>
                            </div>
                            <span class="hidden md:block font-black text-white dark:text-slate-200 tracking-tight uppercase text-xs">Portugal Constitucional</span>
                        </div>
                        <div class="hidden md:flex gap-2 p-1 rounded-xl bg-black/20 dark:bg-black/40 backdrop-blur-sm border border-white/5" role="menubar" onkeydown="handleNavKeydown(event)">
                            ${navButtons}
                        </div>
                        <div class="flex items-center gap-4">
                            <button onclick="openHelp()" class="text-white hover:text-indigo-200 transition-colors" title="Ajuda">
                                <i class="fas fa-circle-question text-lg"></i>
                            </button>
                             <button onclick="toggleTheme()" class="text-white hover:text-indigo-200 transition-colors" title="Alternar Tema">
                                <i class="fas ${APP_STATE.theme === 'dark' ? 'fa-sun' : 'fa-moon'} text-lg"></i>
                            </button>
                            <div class="text-right hidden sm:block">
                                <p class="text-[10px] font-bold text-white/50 dark:text-slate-400 uppercase tracking-widest">Progresso</p>
                                <p class="text-xs font-black text-white dark:text-slate-200">${Math.round((APP_STATE.user.score / TOTAL_QUESTIONS) * 100)}% Correto</p>
                            </div>
                            <button onclick="toggleMenu()" class="md:hidden text-xl text-white">
                                <i class="fas fa-bars"></i>
                            </button>
                        </div>
                    </div>
                    ${mobileMenu}
                </nav>
            `;
        }

        function renderQuiz(questions, moduleId) {
            const modState = APP_STATE.quizState[moduleId] || {};
            const answeredCount = Object.keys(modState).length;
            const totalCount = questions.length;
            
            return `
                <div class="space-y-6">
                    <div class="flex justify-between items-center mb-6 pb-4 border-b border-slate-200 dark:border-slate-700">
                        <span class="font-bold text-slate-500 dark:text-slate-400 uppercase text-xs tracking-widest">Progresso do Módulo</span>
                        <span class="px-3 py-1 bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300 rounded-full text-xs font-black">
                            ${answeredCount} / ${totalCount} Respondidas
                        </span>
                    </div>
                    ${questions.map((q, qIdx) => {
                        const qState = modState[qIdx];
                        const isAnswered = !!qState;
                        
                        let feedbackBlock = '';
                        if (isAnswered) {
                            const isCorrect = qState.isCorrect;
                            feedbackBlock = `
                                <div class="p-5 rounded-2xl text-base font-bold border-l-8 animate-pulse ${isCorrect ? 'bg-emerald-50 text-emerald-700 border-emerald-500 dark:bg-emerald-900/30 dark:text-emerald-300 dark:border-emerald-600' : 'bg-rose-50 text-rose-700 border-rose-500 dark:bg-rose-900/30 dark:text-rose-300 dark:border-rose-600'}">
                                    <div class="flex items-center gap-2 mb-2">
                                        <i class="fas ${isCorrect ? 'fa-check-circle' : 'fa-info-circle'} text-xl"></i>
                                        <span class="uppercase tracking-wide text-xs">${isCorrect ? 'Resposta Correta!' : 'Explicação'}</span>
                                    </div>
                                    <p class="font-normal text-sm md:text-base leading-relaxed">${q.f}</p>
                                </div>
                            `;
                        }

                        return `
                        <div class="bg-indigo-50/50 dark:bg-slate-800/50 p-6 md:p-8 rounded-[2rem] border border-white/50 dark:border-white/10 shadow-sm space-y-6 transition-all hover:bg-white dark:hover:bg-slate-800 hover:shadow-lg">
                            <div class="flex items-start gap-5">
                                <span class="shrink-0 w-10 h-10 bg-indigo-100 dark:bg-indigo-900/50 rounded-full flex items-center justify-center font-black text-lg text-indigo-600 dark:text-indigo-300">${qIdx + 1}</span>
                                <p class="font-bold text-slate-800 dark:text-slate-200 text-lg leading-snug pt-1">${q.q}</p>
                            </div>
                            <div class="grid gap-3" id="quiz-opts-${moduleId}-${qIdx}">
                                <!-- Options injected via JS after -->
                            </div>
                            ${feedbackBlock}
                        </div>`;
                    }).join('')}
                </div>
            `;
        }

        function postRenderQuiz(questions, moduleId) {
            questions.forEach((q, qIdx) => {
                const container = document.getElementById(`quiz-opts-${moduleId}-${qIdx}`);
                if (!container) return;
                
                const modState = APP_STATE.quizState[moduleId] || {};
                const qState = modState[qIdx];
                const isAnswered = !!qState;

                // Clear and append
                container.innerHTML = '';
                q.o.forEach((opt, oIdx) => {
                     let btnClass = "w-full text-left p-4 rounded-xl border-2 font-semibold transition-all duration-200 text-sm ";
                    if (!isAnswered) {
                        btnClass += "border-white bg-white shadow-sm text-slate-600 hover:border-indigo-500 hover:text-indigo-700 hover:shadow-md dark:bg-slate-800 dark:border-slate-700 dark:text-slate-300 dark:hover:border-indigo-400 dark:hover:text-indigo-300";
                    } else {
                        if (oIdx === q.c) {
                            btnClass += "bg-emerald-100 border-emerald-500 text-emerald-800 shadow-none dark:bg-emerald-900/50 dark:border-emerald-500 dark:text-emerald-200";
                        } else if (qState && qState.selectedIndex === oIdx && !qState.isCorrect) {
                            btnClass += "bg-rose-100 border-rose-500 text-rose-800 shadow-none dark:bg-rose-900/50 dark:border-rose-500 dark:text-rose-200";
                        } else {
                            btnClass += "bg-slate-50 border-transparent text-slate-300 opacity-50 shadow-none dark:bg-slate-800 dark:text-slate-600";
                        }
                    }
                    const btn = document.createElement('button');
                    btn.className = btnClass;
                    btn.textContent = opt;
                    if(isAnswered) btn.disabled = true;
                    else btn.onclick = () => handleQuizAnswer(moduleId, qIdx, oIdx, q);
                    container.appendChild(btn);
                });
            });
        }


        function renderWelcome() {
            return `
            <div class="flex-1 flex items-center justify-center p-6">
                <div class="bg-white/90 dark:bg-slate-900/90 backdrop-blur-xl p-8 md:p-16 rounded-[3rem] max-w-4xl w-full text-center shadow-2xl border border-white/50 dark:border-slate-700 animate-fade-in transition-colors duration-500">
                    <div class="inline-flex p-6 bg-indigo-600 rounded-[2rem] mb-8 shadow-xl shadow-indigo-300 dark:shadow-none transform -rotate-6">
                        <i class="fas fa-landmark text-5xl text-white"></i>
                    </div>
                    <h1 class="serif text-4xl md:text-6xl font-black text-indigo-950 dark:text-indigo-100 mb-6 leading-tight">200 Anos de<br/>Leis Fundamentais</h1>
                    <p class="text-lg md:text-xl text-slate-600 dark:text-slate-300 mb-10 leading-relaxed max-w-2xl mx-auto">Uma ferramenta interativa para explorar as grandes ruturas da história constitucional de Portugal.</p>
                    <div class="max-w-md mx-auto space-y-4">
                        <input type="text" id="nameInput" placeholder="Escreve o teu nome completo..." 
                            class="w-full p-5 bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-700 rounded-2xl focus:ring-4 focus:ring-indigo-100 dark:focus:ring-indigo-900 focus:border-indigo-600 outline-none text-lg text-center font-bold text-slate-900 dark:text-white transition-all placeholder:text-slate-400"
                            oninput="APP_STATE.inputName = this.value">
                        <button onclick="handleStart()" class="w-full bg-indigo-600 text-white py-5 rounded-2xl font-black text-xl hover:bg-indigo-700 transition-all transform hover:scale-[1.02] shadow-xl shadow-indigo-200 dark:shadow-none">
                            Entrar na Assembleia <i class="fas fa-chevron-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>`;
        }

        function renderIntro() {
            const accordionHtml = INTRO_DOSSIER.map((item, idx) => `
                <div class="bg-white dark:bg-slate-900 rounded-2xl border border-slate-100 dark:border-slate-800 shadow-sm overflow-hidden transition-colors">
                    <button data-accordion="true" onclick="toggleAccordion('intro-${idx}')" class="w-full flex justify-between items-center p-5 text-left font-bold text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-800">
                        <span class="flex items-center gap-3"><i class="fas fa-file-invoice text-indigo-500"></i> ${item.t}</span>
                        <i class="fas fa-chevron-down transition-transform ${APP_STATE.activeAccordion === `intro-${idx}` ? 'rotate-180' : ''}"></i>
                    </button>
                    <div class="${APP_STATE.activeAccordion === `intro-${idx}` ? 'block' : 'hidden'} p-6 bg-slate-50 dark:bg-slate-800/50 border-t border-slate-100 dark:border-slate-800 text-slate-600 dark:text-slate-300 leading-relaxed">
                        ${item.c}
                    </div>
                </div>
            `).join('');

            const flashcardsHtml = FLASHCARDS.map(card => `
                <div class="group h-64 perspective-1000 cursor-pointer">
                    <div class="flip-card-inner relative w-full h-full transition-all duration-700">
                        <div class="absolute inset-0 backface-hidden bg-white/10 backdrop-blur-md border border-white/20 rounded-3xl p-6 flex flex-col items-center justify-center text-center shadow-xl">
                            <i class="fas fa-bolt text-yellow-400 text-3xl mb-4"></i>
                            <p class="font-black text-sm uppercase tracking-tight text-white">${card.f}</p>
                        </div>
                        <div class="absolute inset-0 backface-hidden rotate-y-180 bg-white dark:bg-slate-800 rounded-3xl p-6 flex items-center justify-center text-center shadow-xl border border-transparent dark:border-slate-700">
                            <p class="text-indigo-900 dark:text-indigo-200 font-medium leading-relaxed text-sm">${card.b}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            return `
            <div class="space-y-16 animate-fade-in pt-8">
                <div class="text-center space-y-4">
                    <span class="px-4 py-1.5 bg-white/10 border border-white/20 backdrop-blur-md rounded-full text-white text-[10px] font-black uppercase tracking-widest inline-block shadow-lg">Módulo I: Análise Comparativa</span>
                    <h2 class="serif text-4xl md:text-6xl font-black text-white drop-shadow-lg">Ruturas & Evoluções</h2>
                    <p class="text-lg text-indigo-100 max-w-3xl mx-auto font-light drop-shadow-md">Uma sucessão de textos fundamentais que definem a modernidade jurídica portuguesa.</p>
                </div>

                <div class="bg-indigo-50/95 dark:bg-slate-900/95 backdrop-blur-xl p-8 md:p-12 rounded-[2.5rem] shadow-2xl space-y-12 transition-colors duration-500">
                     <div class="space-y-6">
                        <h3 class="flex items-center gap-3 font-serif text-xl font-bold text-slate-700 dark:text-slate-200 uppercase tracking-widest">
                            <span class="w-1 h-6 bg-indigo-600 rounded-full"></span> A Linha de Evolução
                        </h3>
                        <div class="relative group cursor-zoom-in rounded-2xl overflow-hidden border-4 border-white dark:border-slate-700 shadow-lg bg-white dark:bg-slate-800" onclick="openZoom('${INTRO_MEDIA.image}')">
                            <img src="${INTRO_MEDIA.image}" alt="Infografia" class="w-full max-h-[500px] object-contain mx-auto transition duration-700 group-hover:scale-105" />
                            <div class="absolute inset-0 bg-indigo-900/40 opacity-0 group-hover:opacity-100 transition-all flex items-center justify-center">
                                <span class="bg-white text-indigo-900 px-6 py-2 rounded-full font-bold shadow-xl"><i class="fas fa-search-plus mr-2"></i> Explorar</span>
                            </div>
                        </div>
                     </div>
                     
                     <div class="space-y-6">
                        <h3 class="flex items-center gap-3 font-serif text-xl font-bold text-slate-700 dark:text-slate-200 uppercase tracking-widest">
                            <span class="w-1 h-6 bg-indigo-600 rounded-full"></span> Sala Multimédia
                        </h3>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="space-y-2">
                                 <p class="font-bold text-slate-500 dark:text-slate-400 uppercase text-xs tracking-wide">Vídeo Introdutório</p>
                                 <div class="rounded-2xl overflow-hidden shadow-lg border-4 border-white dark:border-slate-700 aspect-video bg-black">
                                    <video src="${INTRO_MEDIA.video}" controls class="w-full h-full"></video>
                                 </div>
                            </div>
                            <div class="space-y-2">
                                 <p class="font-bold text-slate-500 dark:text-slate-400 uppercase text-xs tracking-wide">Podcast</p>
                                 <div class="h-full rounded-2xl overflow-hidden shadow-lg border-4 border-white dark:border-slate-700 bg-slate-100 dark:bg-slate-800 p-8 flex flex-col items-center justify-center gap-4">
                                    <div class="w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center text-white text-2xl shadow-lg"><i class="fas fa-headphones-alt"></i></div>
                                    <audio src="${INTRO_MEDIA.podcast}" controls class="w-full"></audio>
                                 </div>
                            </div>
                        </div>
                     </div>

                     <div class="space-y-6">
                        <h3 class="flex items-center gap-3 font-serif text-xl font-bold text-slate-700 dark:text-slate-200 uppercase tracking-widest">
                            <span class="w-1 h-6 bg-indigo-600 rounded-full"></span> Dossier de Análise
                        </h3>
                        <div class="space-y-3" role="region" onkeydown="handleAccordionKeydown(event)">${accordionHtml}</div>
                     </div>
                </div>

                <div class="space-y-10">
                    <h3 class="serif text-3xl font-black text-center text-white uppercase tracking-tight drop-shadow-lg">Conceitos-Chave</h3>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">${flashcardsHtml}</div>
                </div>

                <div class="bg-white dark:bg-slate-900 p-8 md:p-14 rounded-[2.5rem] shadow-2xl text-center transition-colors duration-500">
                     <h3 class="serif text-3xl font-black mb-12 text-slate-800 dark:text-slate-100 uppercase tracking-tight">Questionário de Preparação</h3>
                     <div class="text-left">
                        ${renderQuiz(INTRO_QUIZ, 'intro')}
                     </div>
                     <div class="mt-12 text-center">
                        <button onclick="navigateTo('1822')" class="bg-slate-900 dark:bg-indigo-600 text-white px-10 py-5 rounded-full font-black text-xl hover:bg-black dark:hover:bg-indigo-700 transition shadow-xl hover:-translate-y-1 transform">
                            Avançar para 1822 <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                     </div>
                </div>
            </div>`;
        }

        function renderModuleView(mod) {
            const accordionHtml = mod.guide.map((item, idx) => `
                <div class="bg-white dark:bg-slate-900 rounded-2xl border border-slate-100 dark:border-slate-800 shadow-sm overflow-hidden transition-colors">
                    <button data-accordion="true" onclick="toggleAccordion('${mod.id}-${idx}')" class="w-full flex justify-between items-center p-5 text-left font-bold text-slate-700 dark:text-slate-200 hover:bg-slate-50 dark:hover:bg-slate-800 transition">
                        <span class="flex items-center gap-3"><i class="fas fa-bookmark text-indigo-500"></i> ${item.t}</span>
                        <i class="fas fa-chevron-down transition-transform ${APP_STATE.activeAccordion === `${mod.id}-${idx}` ? 'rotate-180' : ''}"></i>
                    </button>
                    <div class="${APP_STATE.activeAccordion === `${mod.id}-${idx}` ? 'block' : 'hidden'} p-6 text-slate-600 dark:text-slate-300 leading-relaxed border-t border-slate-100 dark:border-slate-800 bg-slate-50 dark:bg-slate-800/50">
                        ${item.c}
                    </div>
                </div>
            `).join('');

            return `
            <div class="space-y-8 animate-fade-in pt-4">
                <!-- Top Section: Title & Challenge Card -->
                <div class="grid lg:grid-cols-3 gap-8 items-center mb-4">
                    <div class="lg:col-span-2 text-center lg:text-left space-y-2">
                        <div class="inline-block px-4 py-1 rounded-full border border-white/30 bg-white/10 backdrop-blur-md text-white text-[10px] font-black tracking-widest uppercase mb-2 shadow-lg">
                            ${mod.label}
                        </div>
                        <h2 class="serif text-4xl md:text-6xl font-black text-white leading-tight drop-shadow-md">
                            ${mod.title}
                        </h2>
                        <p class="text-lg text-indigo-100 font-light drop-shadow-sm max-w-2xl">
                            ${mod.sub}
                        </p>
                    </div>

                    <!-- Challenge Card (Floating Right) -->
                    <div class="lg:col-span-1">
                        <div class="bg-${mod.color}-600 rounded-2xl p-6 shadow-2xl transform transition hover:scale-[1.02] border border-white/10 relative overflow-hidden group">
                             <div class="absolute top-0 right-0 p-4 opacity-10"><i class="fas fa-pencil-alt text-6xl text-white"></i></div>
                             <div class="relative z-10">
                                <h4 class="font-bold text-white text-lg mb-2 border-b border-white/20 pb-2">${mod.activity.t}</h4>
                                <p class="text-white/90 text-xs leading-relaxed mb-4 line-clamp-3">${mod.activity.c}</p>
                                <button onclick="openChallenge('${mod.activity.t}', '${mod.activity.c.replace(/'/g, "\\'")}')" 
                                    class="w-full bg-white text-${mod.color}-700 py-2.5 rounded-lg text-xs font-black uppercase tracking-wide hover:bg-slate-50 transition shadow-md flex items-center justify-center gap-2">
                                    Realizar Desafio <i class="fas fa-pen"></i>
                                </button>
                             </div>
                        </div>
                    </div>
                </div>

                <!-- Main White Content Card -->
                <div class="bg-indigo-50/95 dark:bg-slate-900/95 backdrop-blur-xl p-6 md:p-10 rounded-[2.5rem] shadow-2xl space-y-12 transition-colors duration-500">
                    
                    <!-- Infografia Section -->
                    <div class="space-y-4">
                        <h3 class="flex items-center gap-3 font-serif text-xl font-bold text-slate-700 dark:text-slate-200 uppercase tracking-widest">
                            <span class="w-1 h-6 bg-indigo-600 rounded-full"></span> Infografia
                        </h3>
                        <div class="relative group cursor-pointer overflow-hidden rounded-2xl border-4 border-white dark:border-slate-700 shadow-lg bg-white dark:bg-slate-800" onclick="openZoom('${mod.infoImage}')">
                            <img src="${mod.infoImage}" class="w-full max-h-[500px] object-contain mx-auto transition duration-700 group-hover:scale-[1.02]" alt="Info" />
                            <div class="absolute inset-0 bg-indigo-900/20 opacity-0 group-hover:opacity-100 flex items-center justify-center transition-all">
                                <span class="bg-white/90 text-indigo-900 px-4 py-2 rounded-full font-bold text-sm shadow-lg transform translate-y-4 group-hover:translate-y-0 transition">
                                    <i class="fas fa-search-plus mr-2"></i> Ampliar
                                </span>
                            </div>
                        </div>
                    </div>

                    <!-- Video Section -->
                     ${mod.videoSrc ? `
                    <div class="space-y-4">
                        <h3 class="flex items-center gap-3 font-serif text-xl font-bold text-slate-700 dark:text-slate-200 uppercase tracking-widest">
                            <span class="w-1 h-6 bg-indigo-600 rounded-full"></span> Contexto Audiovisual
                        </h3>
                        <div class="rounded-2xl overflow-hidden shadow-lg border-4 border-white dark:border-slate-700 bg-black aspect-video relative group">
                             ${mod.videoSrc.endsWith('.jpg') ? `<img src="${mod.videoSrc}" class="w-full h-full object-cover opacity-90 group-hover:opacity-100 transition">` : `<video src="${mod.videoSrc}" controls class="w-full h-full"></video>`}
                        </div>
                    </div>` : ''}

                    <!-- Accordion Guide -->
                    <div class="space-y-4">
                       <h3 class="flex items-center gap-3 font-serif text-xl font-bold text-slate-700 dark:text-slate-200 uppercase tracking-widest">
                            <span class="w-1 h-6 bg-indigo-600 rounded-full"></span> Guia de Estudo
                       </h3>
                       <div class="space-y-3" role="region" onkeydown="handleAccordionKeydown(event)">${accordionHtml}</div>
                    </div>
                </div>

                <!-- Quiz Section (Separate Card below) -->
                <div class="bg-white dark:bg-slate-900 p-8 md:p-14 rounded-[2.5rem] shadow-2xl mt-12 text-center transition-colors duration-500">
                     <h3 class="serif text-3xl font-black mb-12 text-slate-800 dark:text-slate-100 uppercase tracking-tight">Questionário Interativo</h3>
                     <div class="text-left">
                        ${renderQuiz(mod.quiz, mod.id)}
                     </div>
                     <div class="mt-16 text-center">
                        <button onclick="nextModule('${mod.id}')" class="bg-indigo-600 text-white px-12 py-5 rounded-full font-black text-lg hover:bg-indigo-700 transition shadow-xl hover:shadow-2xl hover:-translate-y-1 transform">
                            ${mod.id === '1976' ? 'Ver Certificado' : 'Próximo Módulo'} <i class="fas fa-arrow-right ml-2"></i>
                        </button>
                     </div>
                </div>
            </div>`;
        }

        function renderFinish() {
            return `
            <div class="py-10 animate-fade-in flex-1 flex flex-col justify-center">
                <div id="certificate-area" class="bg-white p-12 md:p-24 rounded-[3rem] shadow-2xl border-[16px] border-double border-indigo-100 max-w-5xl mx-auto text-center relative overflow-hidden print-only text-slate-900">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-indigo-50 rounded-bl-full opacity-50"></div>
                    <div class="relative z-10 space-y-8">
                        <div class="inline-flex p-8 bg-indigo-600 rounded-3xl shadow-2xl shadow-indigo-200 mb-6">
                            <i class="fas fa-award text-white text-6xl"></i>
                        </div>
                        <h2 class="serif text-indigo-600 text-xs font-black tracking-[0.5em] uppercase">Diploma Constitucional</h2>
                        <h3 class="serif text-5xl md:text-6xl font-black text-slate-900 leading-tight">Cidadão de Excelência</h3>
                        <p class="text-2xl text-slate-400 italic font-light">Certifica-se que</p>
                        <h4 class="text-5xl font-black border-b-4 border-indigo-600 inline-block px-10 pb-2 text-slate-800 uppercase tracking-widest">${APP_STATE.user.name}</h4>
                        <p class="text-xl text-slate-600 max-w-3xl mx-auto leading-relaxed pt-6">concluiu com êxito a sequência didática <strong>"200 Anos de Leis Fundamentais"</strong>, demonstrando competências avançadas na análise histórica.</p>
                        <div class="grid grid-cols-2 gap-12 border-t-2 border-slate-100 pt-12 mt-12">
                            <div class="text-left">
                                <p class="text-xs text-slate-400 font-bold uppercase tracking-widest mb-1">Resultado Final</p>
                                <p class="text-4xl font-black text-indigo-600">${Math.round((APP_STATE.user.score / TOTAL_QUESTIONS) * 100)}%</p>
                            </div>
                            <div class="flex flex-col items-end justify-end">
                                <div class="w-48 border-t-2 border-slate-900 pt-2 text-center">
                                    <p class="serif italic text-lg text-slate-900 font-bold">O Professor</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-12 flex flex-wrap justify-center gap-4 no-print">
                    <button onclick="window.print()" class="bg-slate-900 dark:bg-slate-700 text-white px-8 py-4 rounded-2xl font-bold flex items-center gap-3 hover:bg-black dark:hover:bg-slate-600 transition">
                        <i class="fas fa-print"></i> Imprimir
                    </button>
                    <button onclick="openReview()" class="bg-indigo-600 text-white px-8 py-4 rounded-2xl font-bold flex items-center gap-3 hover:bg-indigo-700 transition">
                        <i class="fas fa-list-check"></i> Rever Respostas
                    </button>
                    <button onclick="handleShare()" class="bg-emerald-600 text-white px-8 py-4 rounded-2xl font-bold flex items-center gap-3 hover:bg-emerald-700 transition">
                        <i class="fas fa-share-alt"></i> Partilhar
                    </button>
                </div>
            </div>`;
        }

        function render() {
            const root = document.getElementById('app-root');
            const nav = renderNavbar();
            let content = '';

            if (APP_STATE.view === 'welcome') content = renderWelcome();
            else if (APP_STATE.view === 'intro') content = renderIntro();
            else if (APP_STATE.view === 'finish') content = renderFinish();
            else if (MODULES[APP_STATE.view]) content = renderModuleView(MODULES[APP_STATE.view]);

            root.innerHTML = nav + '<main class="max-w-7xl w-full mx-auto p-4 md:p-8 pb-32 flex-1 flex flex-col">' + content + '</main>';
            
            // Post-render logic (Quiz Buttons)
            if (APP_STATE.view === 'intro') postRenderQuiz(INTRO_QUIZ, 'intro');
            else if (MODULES[APP_STATE.view]) postRenderQuiz(MODULES[APP_STATE.view].quiz, APP_STATE.view);
        }

        // --- INTERAÇÕES ---

        function toggleMenu() {
            APP_STATE.isMenuOpen = !APP_STATE.isMenuOpen;
            render();
        }

        function toggleAccordion(id) {
            APP_STATE.activeAccordion = APP_STATE.activeAccordion === id ? null : id;
            render();
        }

        function nextModule(currentId) {
            const currentIndex = MODULE_ORDER.indexOf(currentId);
            if (currentIndex < MODULE_ORDER.length - 1) {
                navigateTo(MODULE_ORDER[currentIndex + 1]);
            }
        }

        async function handleShare() {
            const text = `Concluí a jornada constitucional com ${Math.round((APP_STATE.user.score / TOTAL_QUESTIONS) * 100)}% de sucesso!`;
            if (navigator.share) {
                try { await navigator.share({ title: 'Portugal Constitucional', text: text, url: window.location.href }); } catch(e){}
            } else {
                try { await navigator.clipboard.writeText(text + ' ' + window.location.href); alert('Texto copiado!'); } catch(e){}
            }
        }

        // --- MODAIS ---

        function closeModal() {
            document.getElementById('modal-container').innerHTML = '';
            document.body.style.overflow = 'unset';
        }

        function renderModal(content) {
            document.body.style.overflow = 'hidden';
            document.getElementById('modal-container').innerHTML = `
                <div class="fixed inset-0 z-[9999] flex items-center justify-center p-4 bg-slate-900/95 backdrop-blur-sm animate-fade-in" onclick="closeModal()">
                    <div class="relative bg-white dark:bg-slate-900 rounded-[2rem] shadow-2xl max-h-[90vh] overflow-y-auto w-auto max-w-[95vw]" onclick="event.stopPropagation()">
                        <button onclick="closeModal()" class="absolute top-6 right-6 text-slate-400 hover:text-slate-800 dark:hover:text-white transition-colors z-50 p-2"><i class="fas fa-times text-2xl"></i></button>
                        ${content}
                    </div>
                </div>
            `;
        }

        function openZoom(imgSrc) {
            renderModal(`<img src="${imgSrc}" alt="Zoom" class="max-h-[85vh] rounded-xl shadow-2xl" />`);
        }

        function openChallenge(title, desc) {
            APP_STATE.challengeData = { title, desc };
            APP_STATE.challengeInput = '';
            renderModal(`
                <div class="w-full max-w-2xl p-8 text-slate-900 dark:text-slate-100">
                    <div class="space-y-6">
                        <div>
                            <h3 class="serif text-3xl font-black text-indigo-900 dark:text-indigo-200 mb-2">${title}</h3>
                            <p class="text-slate-500 dark:text-slate-400 font-bold uppercase text-xs tracking-widest">Laboratório de História</p>
                        </div>
                        <div class="bg-indigo-50 dark:bg-slate-800 p-6 rounded-2xl text-slate-700 dark:text-slate-300 leading-relaxed border-l-4 border-indigo-500">${desc}</div>
                        <textarea id="challengeArea" class="w-full h-48 p-4 bg-slate-50 dark:bg-slate-800 border-2 border-slate-200 dark:border-slate-700 rounded-2xl focus:ring-4 focus:ring-indigo-100 dark:focus:ring-indigo-900 outline-none resize-none dark:text-white" placeholder="Escreve aqui a tua reflexão..." oninput="APP_STATE.challengeInput = this.value"></textarea>
                        <div class="flex gap-4">
                            <button onclick="printChallenge()" class="flex-1 bg-slate-800 text-white py-4 rounded-xl font-bold hover:bg-slate-900 transition"><i class="fas fa-print mr-2"></i> Imprimir</button>
                            <button onclick="closeModal()" class="flex-1 bg-indigo-600 text-white py-4 rounded-xl font-bold hover:bg-indigo-700 transition">Guardar e Sair</button>
                        </div>
                    </div>
                </div>
            `);
        }

        function openHelp() {
            renderModal(`
                <div class="w-full max-w-2xl p-8 text-slate-900 dark:text-slate-100">
                    <div class="text-center mb-8">
                        <div class="inline-flex p-4 bg-indigo-100 dark:bg-indigo-900/50 rounded-full mb-4 text-indigo-600 dark:text-indigo-300">
                            <i class="fas fa-circle-question text-4xl"></i>
                        </div>
                        <h3 class="serif text-3xl font-black text-indigo-950 dark:text-white mb-2">Guia de Utilização</h3>
                        <p class="text-slate-500 dark:text-slate-400">Como navegar pelos 200 anos de história.</p>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="flex gap-4">
                            <div class="w-10 h-10 shrink-0 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold">1</div>
                            <div>
                                <h4 class="font-bold text-lg mb-1">Navegação por Módulos</h4>
                                <p class="text-slate-600 dark:text-slate-400 text-sm">Utiliza a barra superior para viajar entre as diferentes Constituições (1822, 1911, 1933, 1976).</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="w-10 h-10 shrink-0 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold">2</div>
                            <div>
                                <h4 class="font-bold text-lg mb-1">Explorar Conteúdos</h4>
                                <p class="text-slate-600 dark:text-slate-400 text-sm">Em cada módulo, consulta a Infografia, vê o Vídeo e lê o Guia de Estudo clicando nos tópicos para expandir.</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="w-10 h-10 shrink-0 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold">3</div>
                            <div>
                                <h4 class="font-bold text-lg mb-1">Realizar Atividades</h4>
                                <p class="text-slate-600 dark:text-slate-400 text-sm">Completa o 'Desafio de Escrita' (cartão lateral) e responde ao Quiz no final da página para testares os teus conhecimentos.</p>
                            </div>
                        </div>
                        <div class="flex gap-4">
                            <div class="w-10 h-10 shrink-0 bg-indigo-600 text-white rounded-full flex items-center justify-center font-bold">4</div>
                            <div>
                                <h4 class="font-bold text-lg mb-1">Obter Certificado</h4>
                                <p class="text-slate-600 dark:text-slate-400 text-sm">Ao completares todos os módulos, receberás um diploma final com a tua pontuação global.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 pt-6 border-t border-slate-200 dark:border-slate-700 text-center">
                        <button onclick="closeModal()" class="px-8 py-3 bg-indigo-600 text-white rounded-xl font-bold hover:bg-indigo-700 transition">Entendido!</button>
                    </div>
                </div>
            `);
        }

        function openReview() {
            const answersHtml = APP_STATE.user.answers.length === 0 ? '<p class="text-center text-slate-500 dark:text-slate-400">Ainda não respondeste a nenhuma questão.</p>' : 
                APP_STATE.user.answers.map(ans => `
                    <div class="p-6 rounded-2xl border-l-4 ${ans.isCorrect ? 'bg-emerald-50 border-emerald-500 dark:bg-emerald-900/20 dark:border-emerald-500' : 'bg-rose-50 border-rose-500 dark:bg-rose-900/20 dark:border-rose-500'}">
                        <p class="text-xs font-black opacity-50 uppercase tracking-widest mb-2 dark:text-slate-300">${ans.moduleId === 'intro' ? 'Introdução' : `Constituição de ${ans.moduleId}`}</p>
                        <p class="font-bold text-slate-900 dark:text-slate-100 text-lg mb-3">${ans.question}</p>
                        <div class="grid md:grid-cols-2 gap-4 text-sm">
                            <div class="${ans.isCorrect ? 'text-emerald-700 dark:text-emerald-400 font-bold' : 'text-rose-700 dark:text-rose-400 font-bold'}">Tua resposta: ${ans.selected}</div>
                            ${!ans.isCorrect ? `<div class="text-emerald-700 dark:text-emerald-400 font-bold">Correta: ${ans.correct}</div>` : ''}
                        </div>
                        <p class="mt-3 text-slate-500 dark:text-slate-400 text-sm italic border-t border-black/5 dark:border-white/10 pt-3">${ans.feedback}</p>
                    </div>
                `).join('');

            renderModal(`
                <div class="w-full max-w-4xl p-10 space-y-8 text-slate-900 dark:text-slate-100">
                    <div class="flex justify-between items-center border-b pb-6 dark:border-slate-700"><h3 class="serif text-3xl font-black text-indigo-950 dark:text-white">Revisão do Percurso</h3></div>
                    <div class="space-y-6">${answersHtml}</div>
                </div>
            `);
        }

        function printChallenge() {
            const printWindow = window.open('', '_blank');
            if(printWindow) {
                printWindow.document.write(`
                    <html><head><title>Reflexão Constitucional</title>
                    <style>body{font-family:sans-serif;padding:40px;line-height:1.6;}.box{background:#f8fafc;padding:20px;border-radius:10px;border:1px solid #e2e8f0;margin-top:20px;}</style></head>
                    <body><p><b>Aluno:</b> ${APP_STATE.user.name}</p><h1>${APP_STATE.challengeData.title}</h1><p><i>${APP_STATE.challengeData.desc}</i></p>
                    <div class="box"><b>Resposta:</b><br><br>${APP_STATE.challengeInput.replace(/\n/g, '<br>')}</div>
                    <script>setTimeout(() => { window.print(); window.close(); }, 500);<\/script></body></html>
                `);
            }
        }

        // --- INIT ---
        document.addEventListener('keydown', (e) => { if(e.key === 'Escape') closeModal(); });
        init();

    </script>
</body>
</html>